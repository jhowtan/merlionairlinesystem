<ui:composition template="/WEB-INF/templates/default.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="title">Flight Search - Merlion Airlines</ui:define>

    <ui:define name="content">
        <section class="content">
            <div class="container">
                <div class="row">
                    <div class="col-lg-offset-1 col-lg-10 text-center">
                        <h1 class="title">Flight Search</h1>
                        <p class="lead">Now serving more destinations across Asia Pacific, where would you like to go today?</p>
                    </div>
                </div>
                <hr/>
            </div>

            <h:panelGroup styleClass="container" rendered="#{flightSearchManagedBean.step == 1}" layout="block">
                <h:form>
                    <div class="row">
                        <div class="col-lg-4 col-lg-offset-1">
                            <h2 class="form-heading">Destinations</h2>
                            <p class="form-subheading">Please choose the origin location you are flying from, as well as the destination airport you
                            wish to go to.</p>
                        </div>
                        <div class="col-lg-5 col-lg-offset-1">
                            <div class="form-group #{!origin.valid ? 'has-error' : ''}">
                                <label class="control-label" for="origin">Origin</label>
                                <h:selectOneMenu value="#{flightSearchManagedBean.origin}" binding="#{origin}" class="form-control" id="origin"
                                        required="true" requiredMessage="Please choose an origin to fly from.">
                                    <f:selectItem itemLabel="Select One" itemValue=""/>
                                    <f:selectItems value="#{flightSearchManagedBean.getOrigins()}" var="ap"
                                                   itemLabel="#{ap.city.name} (#{ap.id})" itemValue="#{ap.id}" />
                                    <f:ajax render="destination" />
                                </h:selectOneMenu>
                                <h:message for="origin" styleClass="help-block" />
                            </div>
                            <div class="form-group #{!destination.valid ? 'has-error' : ''}">
                                <label class="control-label" for="destination">Destination</label>
                                <h:selectOneMenu value="#{flightSearchManagedBean.destination}" binding="#{destination}" class="form-control" id="destination"
                                                 required="true" requiredMessage="Please choose an destination to fly to.">
                                    <f:selectItem itemLabel="Select One" itemValue=""/>
                                    <f:selectItems value="#{flightSearchManagedBean.getDestinationsByOrigin()}" var="ap"
                                                   itemLabel="#{ap.city.name} (#{ap.id})" itemValue="#{ap.id}" />
                                </h:selectOneMenu>
                                <h:message for="destination" styleClass="help-block" />
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row">
                        <div class="col-lg-4 col-lg-offset-1">
                            <h2 class="form-heading">Dates of Travel</h2>
                            <p class="form-subheading">Please choose your dates of departure and return if any. We will do our best to serve your travel needs with our fleet flying round the clock.</p>
                        </div>
                        <div class="col-lg-5 col-lg-offset-1">
                            <div class="checkbox">
                                <label>
                                    <h:selectBooleanCheckbox styleClass="checkbox" id="roundTrip" value="#{flightSearchManagedBean.roundTrip}">
                                        <f:ajax render="returnDateContainer"/>
                                    </h:selectBooleanCheckbox>
                                    Round Trip
                                </label>
                            </div>
                            <div class="form-group #{!departDate.valid ? 'has-error' : ''}">
                                <label class="control-label" for="departDate">Departure Date</label>
                                <h:inputText pt:type="date" class="form-control" id="departDate" binding="#{departDate}"
                                               value="#{flightSearchManagedBean.departureDate}" pt:min="#{commonManagedBean.formatDate('yyyy-MM-dd', null)}"
                                               required="true" requiredMessage="Please enter a date of departure.">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:inputText>
                                <h:message for="departDate" styleClass="help-block" />
                            </div>
                            <h:panelGroup id="returnDateContainer">
                                <h:panelGroup class="form-group #{!returnDate.valid ? 'has-error' : ''}" rendered="#{flightSearchManagedBean.roundTrip}">
                                    <label class="control-label" for="returnDate">Return Date</label>
                                    <h:inputText pt:type="date" pt:min="#{commonManagedBean.formatDate(departDate, null)}"
                                                 value="#{flightSearchManagedBean.returnDate}" class="form-control" binding="#{returnDate}" id="returnDate"
                                                 required="true" requiredMessage="Please enter the date of your return.">
                                        <f:convertDateTime pattern="yyyy-MM-dd" />
                                    </h:inputText>
                                    <h:message for="returnDate" styleClass="help-block" />
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                    </div>
                    <hr/>
                    <div class="row">
                        <div class="col-lg-4 col-lg-offset-1">
                            <h2 class="form-heading">Flight Options</h2>
                            <p class="form-subheading">Please indicate the travel cabin class you would like to travel in. You may also indicate if you are travelling alone or with many.</p>
                        </div>
                        <div class="col-lg-5 col-lg-offset-1">
                            <div class="form-group #{!travelClass.valid ? 'has-error' : ''}">
                                <label class="control-label" for="travelClass">Travel Class</label>
                                <h:selectOneMenu pt:type="text" styleClass="form-control" id="travelClass"
                                             value="#{flightSearchManagedBean.travelClass}" binding="#{travelClass}"
                                             required="true" requiredMessage="Please choose a travel class">
                                    <f:selectItem itemLabel="Economy" itemValue="3"/>
                                    <f:selectItem itemLabel="Premium Economy" itemValue="2"/>
                                    <f:selectItem itemLabel="Business Class" itemValue="1"/>
                                    <f:selectItem itemLabel="First Class" itemValue="0"/>
                                </h:selectOneMenu>
                                <h:message for="travelClass" styleClass="help-block" />
                            </div>
                            <div class="form-group #{!numPassengers.valid ? 'has-error' : ''}">
                                <label class="control-label" for="numPassengers">Passengers</label>
                                <h:inputText pt:type="number" styleClass="form-control" pt:min="1" pt:max="8"
                                             value="#{flightSearchManagedBean.passengers}" binding="#{numPassengers}" id="numPassengers"
                                             required="true" requiredMessage="Please enter the number of passengers flying"
                                             validatorMessage="A valid number of passengers is required." converterMessage="Please choose between 1 to 8 passengers.">
                                    <f:validateLongRange minimum="1" maximum="8"/>
                                </h:inputText>
                                <h:message for="numPassengers" styleClass="help-block" />
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row">
                        <div class="col-md-6 col-md-push-3 col-lg-6 col-lg-push-3">
                            <h:commandLink action="#{flightSearchManagedBean.nextStep()}" value="Search &amp; Book" styleClass="btn btn-primary btn-lg btn-block" />
                        </div>
                    </div>
                </h:form>
            </h:panelGroup>

            <h:panelGroup styleClass="container" rendered="#{flightSearchManagedBean.step == 2}" layout="block">
                <h:form>


                    <h:panelGroup styleClass="panel panel-default" layout="block">
                        <div class="panel-heading">
                            <h3 class="panel-title">Outbound Flights</h3>
                        </div>
                        <div class="panel-body">
                            <h:panelGroup layout="block" rendered="#{flightSearchManagedBean.getOutboundResults().size() == 0}">No flight found.</h:panelGroup>
                            <table class="table table-hover">
                                <tbody>
                                <ui:repeat value="#{flightSearchManagedBean.getOutboundResults()}" var="flightSearchResult">
                                    <tr>
                                        <td>
                                            <p>From <br/>
                                                <span class="cheapest-price">$#{flightSearchResult.getCheapestPrice()}</span>
                                            </p>
                                            <p>Total Duration: <strong>#{flightSearchResult.getTotalHoursDuration()} hours #{flightSearchResult.getTotalMinDuration()} mins</strong></p>
                                            <span class="stopover-display">
                                                <h:panelGroup rendered="#{flightSearchResult.getStopoverCounts() == 0}">Direct Flight</h:panelGroup>
                                                <h:panelGroup rendered="#{flightSearchResult.getStopoverCounts() == 1}">
                                                    #{flightSearchResult.getStopoverCounts()} Stopover
                                                </h:panelGroup>
                                            </span>
                                        </td>
                                        <td class="container-fluid">
                                            <ui:repeat value="#{flightSearchResult.flightSearchItems}" var="flightSearchItem">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h3><span class="fa fa-plane"></span> #{flightSearchItem.flight.aircraftAssignment.route.origin.id} - #{flightSearchItem.flight.aircraftAssignment.route.destination.id}
                                                            <br/><small>#{flightSearchItem.flight.aircraftAssignment.route.origin.city.name} - #{flightSearchItem.flight.aircraftAssignment.route.destination.city.name}</small>
                                                        </h3>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <span class="flight-display">On #{flightSearchItem.flight.code} <small>(#{flightSearchItem.flight.aircraftAssignment.aircraft.tailNumber})</small></span>
                                                        <strong>Departs:</strong> <small>#{commonManagedBean.formatDate("hh:mm a, E d MMM", flightSearchItem.flight.departureTime)}</small><br/>
                                                        <strong>Arrives:</strong> <small>#{commonManagedBean.formatDate("hh:mm a, E d MMM", flightSearchItem.flight.arrivalTime)}</small>
                                                    </div>
                                                </div>
                                            </ui:repeat>
                                        </td>
                                        <td class="text-center vert-align">
                                            <a class="btn btn-primary" href="#">Select</a>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                </tbody>
                            </table>
                        </div>
                    </h:panelGroup>


                    <h:panelGroup styleClass="panel panel-default" layout="block" rendered="#{flightSearchManagedBean.roundTrip}">
                        <div class="panel-heading">
                            <h3 class="panel-title">Return Flight</h3>
                        </div>
                        <div class="panel-body">
                            <h:panelGroup layout="block" rendered="#{flightSearchManagedBean.getReturnResults().size() == 0}">No flight found.</h:panelGroup>
                            <table class="table table-hover">
                                <ui:repeat value="#{flightSearchManagedBean.getReturnResults()}" var="flightSearchResult">
                                    <tr>
                                        <td>
                                            <p>From $#{flightSearchResult.getCheapestPrice()}</p>
                                            <p>
                                                <h:panelGroup rendered="#{flightSearchResult.getStopoverCounts() == 0}">Direct Flight</h:panelGroup>
                                                <h:panelGroup rendered="#{flightSearchResult.getStopoverCounts() == 1}">#{flightSearchResult.getStopoverCounts()} Stopover</h:panelGroup>
                                            </p>
                                        </td>
                                        <td>
                                            <ui:repeat value="#{flightSearchResult.flightSearchItems}" var="flightSearchItem">
                                                <p>#{flightSearchItem.flight.aircraftAssignment.route.origin.id} - #{flightSearchItem.flight.aircraftAssignment.route.destination.id} on #{flightSearchItem.flight.code} (#{commonManagedBean.formatDate("hh:mm", flightSearchItem.flight.departureTime)} - #{commonManagedBean.formatDate("hh:mm", flightSearchItem.flight.arrivalTime)})</p>
                                            </ui:repeat>
                                        </td>
                                        <td class="text-right">
                                            <a class="btn btn-primary" href="#">Select</a>
                                        </td>
                                    </tr>
                                </ui:repeat>
                            </table>
                        </div>
                    </h:panelGroup>

                </h:form>
            </h:panelGroup>

        </section>
    </ui:define>

</ui:composition>
